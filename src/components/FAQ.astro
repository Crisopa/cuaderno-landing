---
const faqs = [
  {
    question: '¿Esto vale para la inspección?',
    answer: 'Sí. Los informes cumplen con el RD 1311/2012. Cuando venga el inspector, le enseñas el PDF y listo.',
  },
  {
    question: '¿Tengo que meter todas las parcelas a mano?',
    answer: 'Solo una vez. Añades provincia, municipio, polígono, parcela y recinto. Después solo seleccionas de la lista.',
  },
  {
    question: '¿Qué pasa cuando acaban los 30 días?',
    answer: 'Si no eliges un plan, tu cuenta pasa a solo lectura. No pierdes nada. Cuando quieras, activas un plan y sigues.',
  },
  {
    question: '¿Puedo cancelar cuando quiera?',
    answer: 'Sí. Sin permanencia. Cancelas y no se te vuelve a cobrar. Tus datos se guardan 6 meses por si vuelves.',
  },
  {
    question: '¿Funciona en el móvil?',
    answer: 'Sí. Funciona en cualquier navegador. No hace falta instalar nada. Puedes registrar un tratamiento desde la finca.',
  },
  {
    question: '¿Lo puede usar mi asesor?',
    answer: 'Sí. Con el plan Enterprise puedes tener hasta 5 usuarios. Ideal para asesores o cooperativas.',
  },
  {
    question: '¿Y si luego quiero exportar mis datos?',
    answer: 'Tus datos son tuyos. Puedes exportarlos en cualquier momento en PDF o Excel.',
  },
]
---

<section id="faq" class="relative py-24 sm:py-32 bg-gradient-to-b from-gray-50 to-white overflow-hidden">
  <!-- Background decorations -->
  <div class="absolute inset-0 -z-10">
    <div class="absolute top-0 right-1/4 w-80 h-80 bg-primary-100/40 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 left-1/4 w-72 h-72 bg-accent-100/40 rounded-full blur-3xl"></div>
    <!-- Subtle dots pattern -->
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_1px_1px,rgba(0,0,0,0.03)_1px,transparent_0)] bg-[size:24px_24px]"></div>
  </div>

  <div class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="text-center" data-animate>
      <span class="inline-flex items-center rounded-full bg-gradient-to-r from-primary-100 to-primary-50 px-5 py-2 text-sm font-semibold text-primary-800 shadow-sm border border-primary-200/50">
        Dudas
      </span>
      <h2 class="mt-6 text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl lg:text-5xl">
        Preguntas frecuentes
      </h2>
    </div>

    <!-- FAQ Accordion -->
    <div class="mt-16 space-y-4">
      {faqs.map((faq, index) => (
        <div
          class="faq-item group"
          data-animate
          style={`transition-delay: ${index * 50}ms;`}
        >
          <div class="relative rounded-2xl bg-white border border-gray-200/80 overflow-hidden transition-all duration-300 hover:border-primary-200 hover:shadow-lg hover:shadow-primary-900/5">
            <button
              type="button"
              class="faq-button flex w-full items-center justify-between px-6 py-5 text-left transition-colors duration-300 hover:bg-primary-50/50"
              aria-expanded="false"
              aria-controls={`faq-content-${index}`}
            >
              <span class="text-base font-semibold text-gray-900 pr-4 group-hover:text-primary-800 transition-colors">
                {faq.question}
              </span>
              <div class="flex-shrink-0 ml-4">
                <div class="faq-icon-wrapper w-8 h-8 rounded-full bg-gray-100 group-hover:bg-primary-100 flex items-center justify-center transition-all duration-300">
                  <svg
                    class="faq-icon h-4 w-4 text-gray-500 group-hover:text-primary-600 transition-all duration-300"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                  </svg>
                </div>
              </div>
            </button>
            <div
              id={`faq-content-${index}`}
              class="faq-content overflow-hidden transition-all duration-300 ease-out"
              style="max-height: 0; opacity: 0;"
            >
              <div class="px-6 pb-5 pt-0">
                <div class="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-4"></div>
                <p class="text-gray-600 leading-relaxed">{faq.answer}</p>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>

    <!-- Contact CTA - Te llamamos -->
    <div class="mt-16 text-center" data-animate>
      <div id="callback-container" class="inline-flex flex-col items-center gap-4 rounded-2xl bg-white/80 backdrop-blur-sm border border-gray-200/50 px-8 py-6 shadow-lg shadow-gray-900/5 transition-all duration-500">
        <!-- Header con icono -->
        <div id="callback-header" class="flex items-center gap-3 transition-all duration-300">
          <div id="callback-icon" class="flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-primary-100 to-primary-50 transition-all duration-500">
            <svg id="phone-icon" class="w-6 h-6 text-primary-700 transition-all duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
            </svg>
            <svg id="check-icon" class="w-6 h-6 text-green-600 hidden transition-all duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <span id="callback-text" class="text-gray-600 transition-all duration-300">¿Otra duda? Te llamamos</span>
        </div>
        <!-- Formulario -->
        <form id="callback-form" class="flex flex-col sm:flex-row items-center gap-3 w-full transition-all duration-300 overflow-hidden">
          <input
            type="tel"
            name="phone"
            id="callback-phone"
            placeholder="Tu teléfono"
            required
            class="w-full sm:w-auto px-4 py-3 rounded-xl border border-gray-300 bg-white text-gray-900 placeholder-gray-400 outline-none"
          />
          <button
            type="submit"
            id="callback-btn"
            class="group w-full sm:w-auto inline-flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-primary-600 text-white font-semibold transition-all duration-300 hover:bg-primary-700 hover:shadow-lg hover:shadow-primary-900/25 hover:-translate-y-0.5"
          >
            <span>Te llamamos</span>
            <svg class="w-4 h-4 transition-transform duration-300 group-hover:translate-x-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</section>

<style>
  #callback-phone:-webkit-autofill,
  #callback-phone:-webkit-autofill:hover,
  #callback-phone:-webkit-autofill:focus {
    -webkit-box-shadow: 0 0 0 1000px white inset !important;
    -webkit-text-fill-color: #111827 !important;
    border-color: #e5e7eb !important;
  }
</style>

<script>
  // Callback form handling
  const callbackForm = document.getElementById('callback-form') as HTMLFormElement
  const callbackContainer = document.getElementById('callback-container')
  const callbackIcon = document.getElementById('callback-icon')
  const phoneIcon = document.getElementById('phone-icon')
  const checkIcon = document.getElementById('check-icon')
  const callbackText = document.getElementById('callback-text')
  const phoneInput = document.getElementById('callback-phone') as HTMLInputElement

  // Validar teléfono: acepta +34, espacios, guiones, paréntesis
  function validatePhone(phone: string): boolean {
    // Limpiar: quitar espacios, guiones, paréntesis, +34
    const cleaned = phone.replace(/[\s\-\(\)\+]/g, '').replace(/^34/, '')
    // Debe tener 9 dígitos
    return /^[0-9]{9}$/.test(cleaned)
  }

  // Limpiar teléfono para guardar
  function cleanPhone(phone: string): string {
    return phone.replace(/[\s\-\(\)\+]/g, '').replace(/^34/, '')
  }

  callbackForm?.addEventListener('submit', async (e) => {
    e.preventDefault()
    const phone = phoneInput.value

    if (!validatePhone(phone)) {
      phoneInput.classList.add('border-red-400')
      phoneInput.classList.remove('border-gray-200')
      return
    }

    const cleanedPhone = cleanPhone(phone)

    // TODO: Enviar a tu backend/API
    console.log('Callback solicitado:', cleanedPhone)

    // Animación de éxito
    // 1. Fade out del formulario
    callbackForm.style.opacity = '0'
    callbackForm.style.maxHeight = '0'
    callbackForm.style.marginTop = '0'

    // 2. Cambiar icono y texto
    setTimeout(() => {
      // Cambiar colores del contenedor
      callbackContainer?.classList.remove('border-gray-200/50')
      callbackContainer?.classList.add('border-green-200/50')

      // Cambiar icono
      callbackIcon?.classList.remove('from-primary-100', 'to-primary-50')
      callbackIcon?.classList.add('from-green-100', 'to-green-50')
      phoneIcon?.classList.add('hidden')
      checkIcon?.classList.remove('hidden')

      // Cambiar texto
      if (callbackText) {
        callbackText.textContent = 'Te llamamos pronto'
        callbackText.classList.remove('text-gray-600')
        callbackText.classList.add('text-gray-700', 'font-medium')
      }

      // Ocultar formulario completamente
      callbackForm.style.display = 'none'
    }, 300)
  })

  // Quitar error al escribir
  phoneInput?.addEventListener('input', () => {
    phoneInput.classList.remove('border-red-400')
    phoneInput.classList.add('border-gray-200')
  })

  // FAQ accordion
  const faqItems = document.querySelectorAll('.faq-item')

  faqItems.forEach(item => {
    const button = item.querySelector('.faq-button')
    const content = item.querySelector('.faq-content') as HTMLElement
    const icon = item.querySelector('.faq-icon')
    const iconWrapper = item.querySelector('.faq-icon-wrapper')

    button?.addEventListener('click', () => {
      const isExpanded = button.getAttribute('aria-expanded') === 'true'

      // Cerrar otros items con animación
      faqItems.forEach(otherItem => {
        if (otherItem !== item) {
          const otherButton = otherItem.querySelector('.faq-button')
          const otherContent = otherItem.querySelector('.faq-content') as HTMLElement
          const otherIcon = otherItem.querySelector('.faq-icon')
          const otherIconWrapper = otherItem.querySelector('.faq-icon-wrapper')

          otherButton?.setAttribute('aria-expanded', 'false')
          if (otherContent) {
            otherContent.style.maxHeight = '0'
            otherContent.style.opacity = '0'
          }
          otherIcon?.classList.remove('rotate-180')
          otherIconWrapper?.classList.remove('bg-primary-600')
          otherIconWrapper?.classList.add('bg-gray-100', 'group-hover:bg-primary-100')
          otherIcon?.classList.remove('text-white')
          otherIcon?.classList.add('text-gray-500', 'group-hover:text-primary-600')
        }
      })

      // Toggle current item con animación suave
      button.setAttribute('aria-expanded', (!isExpanded).toString())

      if (!isExpanded) {
        // Opening
        content.style.maxHeight = content.scrollHeight + 'px'
        content.style.opacity = '1'
        icon?.classList.add('rotate-180')
        iconWrapper?.classList.remove('bg-gray-100', 'group-hover:bg-primary-100')
        iconWrapper?.classList.add('bg-primary-600')
        icon?.classList.remove('text-gray-500', 'group-hover:text-primary-600')
        icon?.classList.add('text-white')
      } else {
        // Closing
        content.style.maxHeight = '0'
        content.style.opacity = '0'
        icon?.classList.remove('rotate-180')
        iconWrapper?.classList.add('bg-gray-100', 'group-hover:bg-primary-100')
        iconWrapper?.classList.remove('bg-primary-600')
        icon?.classList.add('text-gray-500', 'group-hover:text-primary-600')
        icon?.classList.remove('text-white')
      }
    })
  })
</script>
