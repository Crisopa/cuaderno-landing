---
import PromoBanner from './PromoBanner.astro'

const navLinks = [
  { href: '#caracteristicas', label: 'Qué incluye' },
  { href: '#precios', label: 'Precios' },
  { href: '#faq', label: 'Dudas' },
]

const appUrl = 'https://panel.crisopa.app'
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-500"
>
  <PromoBanner />
  <!-- Gradient line at top (desactivada mientras el promo banner está activo) -->
  <!-- <div class="h-1 w-full bg-gradient-to-r from-primary-600 via-primary-400 to-accent-500 opacity-0 transition-opacity duration-500" id="header-line"></div> -->

  <nav class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex h-16 items-center justify-between">
      <!-- Logo -->
      <svg class="h-7" viewBox="0 0 510.42032 99.311523" xmlns="http://www.w3.org/2000/svg">
        <g transform="translate(-385.81631,-550.18079)">
          <!-- Texto -->
          <g class="text-gray-900" fill="currentColor">
          <path d="m 869.51978,630.4783 q -6.03135,0 -10.63149,-2.14674 -4.49796,-2.14675 -7.05361,-6.13356 -2.45343,-3.98683 -2.45343,-9.60925 0,-6.13356 2.96458,-10.01815 3.06676,-3.8846 8.48474,-5.82689 5.52023,-1.94229 12.88046,-1.94229 h 12.88053 v 8.48476 h -13.08497 q -4.90685,0 -7.56473,2.45342 -2.55565,2.3512 -2.55565,6.13356 0,3.78237 2.55565,6.13356 2.65788,2.3512 7.56473,2.3512 2.96458,0 5.41801,-1.02225 2.55565,-1.1245 4.19126,-3.68014 1.73783,-2.65787 1.94226,-7.15582 l 3.4757,3.98681 q -0.51111,5.82688 -2.86231,9.81369 -2.24898,3.98683 -6.33801,6.13357 -3.98681,2.04452 -9.81372,2.04452 z"/>
          <path d="m 884.99176,629.04713 v -16.45838 h -2.35121 V 594.2903 q 0,-4.80463 -2.3512,-7.15583 -2.35116,-2.3512 -7.25802,-2.3512 -2.55564,0 -6.13357,0.10227 -3.57792,0.10228 -7.25806,0.30668 -3.57792,0.10227 -6.44023,0.30668 v -12.06268 q 2.3512,-0.20444 5.31574,-0.40889 2.96459,-0.20446 6.03135,-0.20446 3.16903,-0.10228 5.92913,-0.10228 8.58699,0 14.20941,2.24897 5.72462,2.24897 8.58699,7.0536 2.96455,4.80461 2.96455,12.57379 v 34.45017 z"/>
          <path d="m 782.32105,649.49234 v -75.95393 h 11.24487 v 23.92089 l -1.73783,-0.10227 q 0.40888,-8.48476 3.47566,-14.20942 3.16902,-5.72465 8.38254,-8.48476 5.21353,-2.86232 11.65377,-2.86232 5.92911,0 10.63148,2.14675 4.80463,2.14674 8.17811,6.03133 3.4757,3.88458 5.31575,9.09812 1.84004,5.11129 1.84004,11.04041 v 2.14673 q 0,6.03135 -1.84004,11.24488 -1.73783,5.11129 -5.21353,9.0981 -3.37347,3.88459 -8.17805,6.13356 -4.80465,2.14675 -10.73376,2.14675 -6.2358,0 -11.44932,-2.55564 -5.11131,-2.65788 -8.28029,-8.07587 -3.16903,-5.5202 -3.57793,-14.20941 l 4.49793,6.84915 v 36.59691 z m 29.44108,-30.56558 q 4.60019,0 7.97366,-2.24897 3.47566,-2.24897 5.41797,-6.23579 1.94228,-4.08904 1.94228,-9.20034 0,-5.31575 -1.94228,-9.20035 -1.94231,-3.88458 -5.41797,-6.03133 -3.37347,-2.24897 -7.97366,-2.24897 -4.19125,0 -7.76917,1.84008 -3.47566,1.84006 -5.72464,5.41797 -2.14675,3.5779 -2.14675,8.58699 v 4.08903 q 0,4.80463 2.24898,8.17808 2.24898,3.37347 5.82685,5.21354 3.57792,1.84006 7.56473,1.84006 z"/>
          <path d="m 740.44543,630.98944 q -7.36027,0 -12.98274,-2.3512 -5.6224,-2.3512 -9.507,-6.33803 -3.88458,-4.08904 -5.92913,-9.20033 -1.94226,-5.1113 -1.94226,-10.6315 v -2.14675 q 0,-5.72467 2.04449,-10.83596 2.14676,-5.21353 6.03135,-9.20034 3.98681,-4.08904 9.60926,-6.33801 5.62242,-2.3512 12.67603,-2.3512 7.05357,0 12.67599,2.3512 5.62245,2.24897 9.50705,6.33801 3.98681,3.98681 6.03134,9.20034 2.04449,5.11129 2.04449,10.83596 v 2.14675 q 0,5.5202 -2.04449,10.6315 -1.94232,5.11129 -5.82689,9.20033 -3.8846,3.98683 -9.50701,6.33803 -5.62246,2.3512 -12.88048,2.3512 z m 0,-12.16491 q 5.21353,0 8.7914,-2.24897 3.57793,-2.3512 5.41802,-6.23578 1.84004,-3.98682 1.84004,-8.9959 0,-5.11129 -1.94227,-8.99589 -1.84009,-3.98681 -5.52024,-6.23578 -3.57791,-2.3512 -8.58695,-2.3512 -5.00907,0 -8.68922,2.3512 -3.57791,2.24897 -5.52023,6.23578 -1.94228,3.8846 -1.94228,8.99589 0,5.00908 1.84006,8.9959 1.94232,3.88458 5.52023,6.23578 3.57788,2.24897 8.79144,2.24897 z"/>
          <path d="m 676.92617,630.78498 q -11.44932,0 -17.99178,-4.80462 -6.44024,-4.90685 -6.7469,-13.49384 h 12.77825 q 0.30666,2.86233 3.16899,5.21353 2.86231,2.3512 8.99588,2.3512 5.1113,0 8.07588,-1.84008 3.06676,-1.84006 3.06676,-5.00906 0,-2.76011 -2.35119,-4.39572 -2.24899,-1.63563 -7.76918,-2.14675 l -4.90686,-0.51113 q -9.30255,-1.02227 -14.31163,-5.31576 -5.00908,-4.29348 -5.00908,-11.4493 0,-5.72467 2.86232,-9.60926 2.86232,-3.88458 7.8714,-5.82687 5.11129,-2.04452 11.65379,-2.04452 10.22261,0 16.56063,4.49794 6.33797,4.49795 6.64468,13.18716 h -12.77826 q -0.20444,-2.86233 -2.86235,-4.90685 -2.65788,-2.04452 -7.66696,-2.04452 -4.49792,0 -6.95135,1.73784 -2.45343,1.73784 -2.45343,4.49794 0,2.65788 1.94232,4.08904 2.04449,1.43116 6.54246,1.9423 l 4.90686,0.51113 q 9.81366,1.02225 15.33389,5.41797 5.62243,4.39572 5.62243,11.85822 0,5.5202 -3.06676,9.60924 -2.96459,3.98683 -8.38256,6.2358 -5.41798,2.24897 -12.77825,2.24897 z"/>
          <path d="m 631.4357,566.89372 q -4.19126,0 -6.23578,-2.14675 -1.94229,-2.24897 -1.94229,-5.5202 0,-3.47569 1.94229,-5.62244 2.04452,-2.14674 6.23578,-2.14674 4.19127,0 6.13356,2.14674 1.94231,2.14675 1.94231,5.62244 0,3.27123 -1.94231,5.5202 -1.94229,2.14675 -6.13356,2.14675 z"/>
          <path d="m 618.453,584.16991 v -10.6315 h 21.9786 v 10.6315 z"/>
          <path d="m 626.22219,629.04713 v -55.50872 h 14.20941 v 55.50872 z"/>
          <path d="m 578.01783,629.04713 v -55.50872 h 11.24485 v 23.51198 H 588.956 q 0,-11.96044 5.11131,-18.09401 5.1113,-6.13356 15.02722,-6.13356 h 2.04452 v 12.36936 h -3.88459 q -7.15582,0 -11.14263,3.88459 -3.88459,3.78236 -3.88459,11.04041 v 28.92995 z"/>
          <path d="m 540.79725,630.98944 q -7.25805,0 -12.57381,-2.45343 -5.21352,-2.45343 -8.79144,-6.54246 -3.47568,-4.08904 -5.21352,-9.20035 -1.73784,-5.1113 -1.73784,-10.42705 v -1.94229 q 0,-5.62244 1.73784,-10.73375 1.84007,-5.21352 5.41799,-9.20033 3.5779,-4.08904 8.79144,-6.44024 5.31574,-2.45342 12.26711,-2.45342 7.25804,0 12.98271,2.86233 5.72465,2.76009 9.09812,7.76917 3.47568,5.00908 3.88458,11.65377 h -13.80051 q -0.51114,-4.29349 -3.68014,-7.15582 -3.06678,-2.86234 -8.48476,-2.86234 -4.7024,0 -7.87141,2.24898 -3.06677,2.24897 -4.60017,6.23578 -1.53339,3.8846 -1.53339,8.99589 0,4.90686 1.43116,8.89367 1.5334,3.98681 4.60019,6.2358 3.169,2.24896 8.07585,2.24896 3.68013,0 6.33801,-1.32894 2.65787,-1.32893 4.19127,-3.68013 1.63561,-2.3512 2.04452,-5.31576 h 13.8005 q -0.40889,6.74692 -3.98681,11.85821 -3.47568,5.00908 -9.30256,7.87141 -5.72466,2.86234 -13.08493,2.86234 z"/>
          </g>
          <!-- Isologo -->
          <g class="text-primary-800" fill="currentColor">
          <g transform="matrix(10.535868,0,0,10.535868,377.23299,402.99239)">
            <path d="m 4.5614529,13.972116 c -0.7680582,0.03238 -1.4896607,0.473821 -1.8497924,1.194336 l -1.6696231,3.339245 c -0.48648218,0.973025 -0.16981182,2.165967 0.7353515,2.769389 l 2.5044348,1.669624 c 0.7260457,0.484093 1.675668,0.484093 2.4017136,0 L 9.1879721,21.275086 C 9.9980394,20.734954 10.348377,19.713959 10.040719,18.790218 L 9.2059075,16.285784 C 8.9905729,15.639704 8.4831895,15.131506 7.8371101,14.916171 L 5.3326753,14.081359 C 5.0779782,13.996377 4.8174722,13.961326 4.5614529,13.972121 Z m 0.4581682,1.048407 2.5036194,0.835625 a 0.49527016,0.49527016 0 0 0 8.348e-4,0 c 0.3511263,0.117026 0.6256605,0.391564 0.7426889,0.742689 l 0.8348115,2.504436 c 0.168046,0.504557 -0.020591,1.053389 -0.4630594,1.348416 l -2.5044348,1.669622 c -0.3956815,0.263822 -0.9070811,0.263822 -1.3027626,0 L 2.3268842,20.451689 C 1.8308028,20.120991 1.6607846,19.482442 1.9273942,18.949191 l 1.6696231,-3.339247 c 0.2630345,-0.526252 0.8645231,-0.775633 1.4226038,-0.589421 z"/>
            <path d="m 6.5058594,18.181641 a 0.49527003,0.49527003 0 0 0 -0.6738282,0.359375 l -0.8378906,4.175781 a 0.49522051,0.49522051 0 0 0 0.3867188,0.582031 0.49522051,0.49522051 0 0 0 0.5839843,-0.388672 l 0.7207032,-3.585937 2.7109375,1.103515 A 0.49522051,0.49522051 0 0 0 10.041016,20.154297 0.49522051,0.49522051 0 0 0 9.7695313,19.509766 Z"/>
            <path d="m 3.765625,14.162109 a 0.49522051,0.49522051 0 0 0 -0.1855469,0.673829 l 2.3085938,4.048828 a 0.49522051,0.49522051 0 0 0 0.6757812,0.185546 0.49522051,0.49522051 0 0 0 0.1835938,-0.675781 L 4.4394531,14.345703 A 0.49522051,0.49522051 0 0 0 3.765625,14.162109 Z"/>
          </g>
          </g>
        </g>
      </svg>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex md:items-center md:gap-1">
        {navLinks.map(link => (
          <a
            href={link.href}
            class="relative px-4 py-2 text-sm font-medium text-gray-600 hover:text-primary-800 transition-colors rounded-lg hover:bg-primary-50/50 group"
          >
            <span class="relative z-10">{link.label}</span>
            <span class="absolute inset-x-2 -bottom-px h-px bg-gradient-to-r from-primary-500/0 via-primary-500/70 to-primary-500/0 opacity-0 group-hover:opacity-100 transition-opacity"></span>
          </a>
        ))}
      </div>

      <!-- CTA Buttons -->
      <div class="flex items-center gap-3">
        <a
          href={appUrl}
          class="hidden sm:inline-flex text-sm font-medium text-gray-600 hover:text-primary-800 transition-all px-4 py-2 rounded-lg hover:bg-primary-50/50"
        >
          Iniciar sesión
        </a>
        <a
          href={`${appUrl}/register`}
          class="hidden sm:inline-flex group relative items-center justify-center rounded-xl bg-primary-800 px-5 py-2.5 text-sm font-semibold text-white overflow-hidden transition-all duration-300 hover:bg-primary-900 hover:shadow-lg hover:shadow-primary-800/25 hover:-translate-y-0.5"
        >
          <span class="absolute inset-0 bg-gradient-to-r from-primary-600 to-primary-800 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
          <span class="relative flex items-center gap-2">
            Prueba gratis
            <svg class="w-4 h-4 transition-transform duration-300 group-hover:translate-x-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </span>
        </a>

        <!-- Mobile menu button -->
        <button
          id="mobile-menu-button"
          type="button"
          class="md:hidden inline-flex items-center justify-center rounded-xl p-2.5 text-gray-600 hover:bg-primary-50 hover:text-primary-800 transition-colors"
          aria-expanded="false"
          aria-label="Abrir menú"
        >
          <svg id="menu-icon-open" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg id="menu-icon-close" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="hidden md:hidden">
      <div class="space-y-1 pb-4 pt-2 border-t border-gray-100/50 mt-2">
        {navLinks.map(link => (
          <a
            href={link.href}
            class="block rounded-xl px-4 py-3 text-base font-medium text-gray-600 hover:bg-primary-50 hover:text-primary-800 transition-colors"
          >
            {link.label}
          </a>
        ))}
        <a
          href={appUrl}
          class="block rounded-xl px-4 py-3 text-base font-medium text-gray-600 hover:bg-primary-50 hover:text-primary-800 transition-colors"
        >
          Iniciar sesión
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  const header = document.getElementById('header')
  const headerLine = document.getElementById('header-line')
  const mobileMenuButton = document.getElementById('mobile-menu-button')
  const mobileMenu = document.getElementById('mobile-menu')
  const menuIconOpen = document.getElementById('menu-icon-open')
  const menuIconClose = document.getElementById('menu-icon-close')

  // Sticky header con glassmorphism + hide on scroll down
  let lastScroll = 0
  const scrollThreshold = 10
  const hideThreshold = 60 // mínimo recorrido antes de ocultar

  window.addEventListener('scroll', () => {
    const currentScroll = window.scrollY
    const isMenuOpen = mobileMenuButton?.getAttribute('aria-expanded') === 'true'

    // Glassmorphism al hacer scroll
    if (currentScroll > scrollThreshold) {
      header?.classList.add('bg-white/80', 'backdrop-blur-xl', 'shadow-lg', 'shadow-gray-900/5')
      headerLine?.classList.add('opacity-100')
      headerLine?.classList.remove('opacity-0')
    } else {
      header?.classList.remove('bg-white/80', 'backdrop-blur-xl', 'shadow-lg', 'shadow-gray-900/5')
      headerLine?.classList.remove('opacity-100')
      headerLine?.classList.add('opacity-0')
    }

    // Ocultar/mostrar al hacer scroll (solo si el menú móvil está cerrado)
    if (!isMenuOpen && currentScroll > hideThreshold) {
      if (currentScroll > lastScroll) {
        // Scroll down → ocultar
        header?.classList.add('-translate-y-full')
      } else {
        // Scroll up → mostrar
        header?.classList.remove('-translate-y-full')
      }
    } else {
      header?.classList.remove('-translate-y-full')
    }

    lastScroll = currentScroll
  })

  const menuBgClasses = ['bg-white', 'backdrop-blur-xl', 'shadow-lg', 'shadow-gray-900/5']

  function setMenuOpen(open: boolean) {
    if (open) {
      header?.classList.add(...menuBgClasses)
    } else if (window.scrollY <= scrollThreshold) {
      // Solo quitar el fondo si estamos arriba del todo
      header?.classList.remove('bg-white', 'shadow-lg', 'shadow-gray-900/5')
    }
  }

  // Mobile menu toggle
  mobileMenuButton?.addEventListener('click', () => {
    const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true'
    mobileMenuButton.setAttribute('aria-expanded', (!isExpanded).toString())
    mobileMenu?.classList.toggle('hidden')
    menuIconOpen?.classList.toggle('hidden')
    menuIconClose?.classList.toggle('hidden')
    setMenuOpen(!isExpanded)
  })

  // Cerrar menú al hacer click en un enlace
  mobileMenu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu.classList.add('hidden')
      mobileMenuButton?.setAttribute('aria-expanded', 'false')
      menuIconOpen?.classList.remove('hidden')
      menuIconClose?.classList.add('hidden')
      setMenuOpen(false)
    })
  })
</script>
